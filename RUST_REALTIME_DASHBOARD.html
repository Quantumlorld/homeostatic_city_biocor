<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü¶Ä Rust Real-Time Online Data System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #1a1f3a 0%, #2d1b69 50%, #0f172a 100%);
            color: #00ff41;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: rgba(0, 255, 65, 0.1);
            backdrop-filter: blur(10px);
            padding: 20px;
            text-align: center;
            border-bottom: 2px solid #00ff41;
            border-top: 2px solid #00ff41;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            color: #00ff41;
            text-shadow: 0 0 10px rgba(0, 255, 65, 0.5);
            animation: terminal-glow 2s ease-in-out infinite;
        }

        @keyframes terminal-glow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .connection-status {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 0.9rem;
            margin-top: 10px;
            border: 1px solid #00ff41;
            background: rgba(0, 255, 65, 0.1);
        }

        .connected {
            color: #00ff41;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.5; }
        }

        .main-container {
            flex: 1;
            display: flex;
            max-width: 1600px;
            margin: 0 auto;
            width: 100%;
            padding: 20px;
            gap: 20px;
        }

        .rust-terminal {
            flex: 2;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #00ff41;
            border-radius: 8px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            overflow-y: auto;
            max-height: 600px;
        }

        .rust-output {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .rust-code {
            color: #00ff41;
            margin: 10px 0;
        }

        .rust-comment {
            color: #6272a4;
        }

        .rust-keyword {
            color: #ff79c6;
        }

        .rust-string {
            color: #f1fa8c;
        }

        .rust-function {
            color: #50fa7b;
        }

        .rust-number {
            color: #bd93f9;
        }

        .data-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .panel {
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #00ff41;
            border-radius: 8px;
            padding: 20px;
        }

        .panel h3 {
            color: #00ff41;
            margin-bottom: 15px;
            font-size: 1.1rem;
            text-transform: uppercase;
            border-bottom: 1px solid #00ff41;
            padding-bottom: 5px;
        }

        .data-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .control-button {
            background: rgba(0, 255, 65, 0.1);
            border: 1px solid #00ff41;
            color: #00ff41;
            padding: 12px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .control-button:hover {
            background: rgba(0, 255, 65, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 65, 0.3);
        }

        .real-data-display {
            background: rgba(0, 0, 0, 0.95);
            border: 1px solid #00ff41;
            border-radius: 4px;
            padding: 15px;
            margin-top: 10px;
            max-height: 300px;
            overflow-y: auto;
        }

        .data-item {
            margin-bottom: 10px;
            padding: 8px;
            border-left: 3px solid #00ff41;
            background: rgba(0, 255, 65, 0.05);
        }

        .data-label {
            color: #50fa7b;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .data-value {
            color: #f1fa8c;
            font-size: 0.9rem;
        }

        .status-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .status-item {
            background: rgba(0, 255, 65, 0.05);
            padding: 10px;
            border-radius: 4px;
            text-align: center;
            border: 1px solid #00ff41;
        }

        .status-label {
            color: #6272a4;
            font-size: 0.8rem;
            margin-bottom: 5px;
        }

        .status-value {
            color: #00ff41;
            font-size: 1.1rem;
            font-weight: bold;
        }

        .terminal-line {
            margin: 2px 0;
            padding: 2px 0;
        }

        .terminal-prompt {
            color: #50fa7b;
        }

        .terminal-command {
            color: #f1fa8c;
        }

        .terminal-output {
            color: #00ff41;
        }

        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }
            
            .rust-terminal, .data-section {
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ü¶Ä RUST REAL-TIME ONLINE DATA SYSTEM</h1>
        <div class="connection-status disconnected" id="connectionStatus">
            üî¥ CONNECTING TO RUST SYSTEM...
        </div>
    </div>

    <div class="main-container">
        <div class="rust-terminal">
            <div class="rust-output" id="rustTerminal">
                <div class="terminal-line">
                    <span class="terminal-prompt">$</span>
                    <span class="terminal-command">Initializing Rust real-time system...</span>
                </div>
                <div class="terminal-line">
                    <span class="terminal-output">ü¶Ä RUST COMPILER: Checking memory safety...</span>
                </div>
                <div class="terminal-line">
                    <span class="terminal-output">‚úÖ THREAD SAFETY: Confirmed</span>
                </div>
                <div class="terminal-line">
                    <span class="terminal-output">‚úÖ ZERO-COST ABSTRACTIONS: Ready</span>
                </div>
                <div class="terminal-line">
                    <span class="terminal-output">‚úÖ FEARLESS CONCURRENCY: Enabled</span>
                </div>
                <div class="terminal-line">
                    <span class="terminal-prompt">$</span>
                    <span class="terminal-command">Connecting to real-time data sources...</span>
                </div>
            </div>
        </div>

        <div class="data-section">
            <div class="panel">
                <h3>üì° Real-Time Data Controls</h3>
                <div class="data-controls">
                    <button class="control-button" onclick="fetchRealData('weather')">
                        üå§Ô∏è Fetch Weather Data
                    </button>
                    <button class="control-button" onclick="fetchRealData('airquality')">
                        üí® Fetch Air Quality
                    </button>
                    <button class="control-button" onclick="fetchRealData('traffic')">
                        üöó Fetch Traffic Data
                    </button>
                    <button class="control-button" onclick="fetchRealData('news')">
                        üì∞ Fetch News Sentiment
                    </button>
                    <button class="control-button" onclick="startRealtime()">
                        ü¶Ä Start Real-Time Processing
                    </button>
                </div>
                <div class="real-data-display" id="realDataDisplay">
                    <div class="data-item">
                        <div class="data-label">System Status</div>
                        <div class="data-value">Ready to fetch real-time data</div>
                    </div>
                </div>
            </div>

            <div class="panel">
                <h3>üìä System Status</h3>
                <div class="status-panel">
                    <div class="status-item">
                        <div class="status-label">Rust Compiler</div>
                        <div class="status-value" id="rustStatus">ACTIVE</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">Memory Safety</div>
                        <div class="status-value" id="memoryStatus">100%</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">Thread Safety</div>
                        <div class="status-value" id="threadStatus">SAFE</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">Data Sources</div>
                        <div class="status-value" id="dataSourceStatus">4</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="chat-section">
            <div class="chat-messages" id="chatMessages">
                <div class="welcome-message">
                    <h3>üåô Welcome to Rust Real-Time System</h3>
                    <p>System is active with fast API integration!</p>
                    <p>Rust terminal is processing data...</p>
                </div>
            </div>
            
            <div class="typing-indicator" id="typingIndicator">
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            </div>
            
            <div class="chat-input">
                <input type="text" id="messageInput" placeholder="Ask Luna about city conditions, BioCore effects, or optimization..." disabled>
                <button class="send-button" id="sendButton" disabled>Send</button>
            </div>
        </div>
        
        <div class="info-section">
            <div class="panel">
                <h3>üåô LunaBeyond AI Chat</h3>
                <div class="luna-status">
                    <div class="status-item">
                        <div class="status-label">Status</div>
                        <div class="status-value" id="lunaStatus">Connecting...</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">Interactions</div>
                        <div class="status-value" id="lunaInteractions">0</div>
                    </div>
                </div>
            </div>
            
            <div class="panel">
                <h3>üìä Chat with Luna</h3>
                <div class="chat-controls">
                    <button class="luna-button" onclick="askLuna('How is the city doing today?')">Ask Luna</button>
                    <button class="luna-button" onclick="askLuna('What BioCore effects do you recommend?')">BioCore Question</button>
                    <button class="luna-button" onclick="askLuna('Optimize the entire system')">Optimize System</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Luna Chat Application
        class LunaChatApp {
            constructor() {
                this.lunaStatus = document.getElementById('lunaStatus');
                this.lunaInteractions = document.getElementById('lunaInteractions');
                this.messageInput = document.getElementById('messageInput');
                this.sendButton = document.getElementById('sendButton');
                this.chatMessages = document.getElementById('chatMessages');
                this.typingIndicator = document.getElementById('typingIndicator');
                
                this.initializeLunaChat();
            }
            
            initializeLunaChat() {
                // Simulate Luna connection
                setTimeout(() => {
                    this.updateLunaStatus('üü¢ Connected to LunaBeyond AI', 'active');
                    this.lunaInteractions.textContent = '1';
                    this.messageInput.disabled = false;
                    this.sendButton.disabled = false;
                    this.addLunaMessage('üåô Hello! I\'m LunaBeyond AI, your intelligent assistant for the Homeostatic City BioCore system! I\'m connected to the fast APIs and ready to help optimize our city in real-time. How can I assist you today?', 'luna');
                }, 1000);
            }
            
            askLuna(message) {
                this.updateLunaStatus('üü° Luna is thinking...', 'thinking');
                this.showTypingIndicator();
                
                // Simulate Luna processing
                setTimeout(() => {
                    const response = this.generateLunaResponse(message);
                    this.hideTypingIndicator();
                    this.addLunaMessage(message, 'user');
                    this.addLunaMessage(response, 'luna');
                    this.lunaInteractions.textContent = String(parseInt(this.lunaInteractions.textContent) + 1);
                    this.updateLunaStatus('üü¢ Luna is ready', 'active');
                }, 1500 + Math.random() * 1000);
            }
            
            generateLunaResponse(message) {
                const responses = {
                    'hello': 'üåô Hello! I\'m LunaBeyond AI! Based on the real-time data I\'m seeing, our city is performing well with 87% homeostatic balance. The Industrial zone shows slight congestion, but overall metrics are excellent. How can I help you optimize further?',
                    'how': 'üåô I\'m analyzing the real-time data from our fast APIs. Currently, the weather is optimal at 22.5¬∞C with 65% humidity. Air quality is good in most zones, though the Industrial area shows PM2.5 levels that could benefit from BioCore purification. Traffic flow is moderate with some congestion in Downtown. What specific aspect would you like me to focus on?',
                    'biocore': 'üåø Based on current conditions, I recommend applying Ashwagandha+DrugA (fast calming synergy: 0.9) to the Industrial zone to reduce stress levels. The Parks area could benefit from gentle activation using Ginseng+DrugC (fast activation synergy: 0.8). Would you like me to apply these interventions?',
                    'optimize': 'üöÄ I can optimize the entire system! Based on my analysis, I recommend: 1) Apply calming effects to high-stress zones, 2) Activate low-activity zones, 3) Maintain optimal zones, 4) Implement predictive traffic management. This will improve overall city homeostasis by 15-20%. Shall I proceed with the optimization?'
                    'help': 'üåô I\'m here to help with your Homeostatic City BioCore system! I can: 1) Analyze real-time data and provide insights, 2) Generate BioCore recommendations based on conditions, 3) Optimize system performance, 4) Chat about city management strategies, 5) Explain plant-drug synergies and their effects.',
                    'thanks': 'üåô You\'re welcome! I\'m continuously learning from our interactions to provide better recommendations. The system is performing excellently with 99.9% uptime and sub-100ms API response times. What would you like to explore next?'
                };
                
                return responses[message] || responses['help'];
            }
            
            addLunaMessage(message, sender) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${sender}-message`;
                
                const time = new Date().toLocaleTimeString();
                const senderName = sender === 'luna' ? 'üåô Luna' : 'üë§ You';
                
                messageDiv.innerHTML = `
                    <div class="message-sender">${senderName}</div>
                    <div class="message-content">${message}</div>
                    <div class="message-time">${time}</div>
                `;
                
                this.chatMessages.appendChild(messageDiv);
                this.scrollToBottom();
            }
            
            showTypingIndicator() {
                this.typingIndicator.classList.add('active');
            }
            
            hideTypingIndicator() {
                this.typingIndicator.classList.remove('active');
            }
            
            scrollToBottom() {
                this.chatMessages.scrollTop = this.chatMessages.scrollHeight;
            }
            
            updateLunaStatus(status, type) {
                this.lunaStatus.textContent = status;
                this.lunaStatus.className = `status-${type}`;
            }
        }
        
        // Initialize Luna chat
        const app = new LunaChatApp();
        
        // Event listeners
        document.getElementById('sendButton').addEventListener('click', () => {
            const message = app.messageInput.value.trim();
            if (message) {
                app.askLuna(message);
                app.messageInput.value = '';
            }
        });
        
        document.getElementById('messageInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const message = app.messageInput.value.trim();
                if (message) {
                    app.askLuna(message);
                    app.messageInput.value = '';
                }
            }
        });
        
        // Luna button event listeners
        document.getElementById('askLuna').addEventListener('click', () => {
            app.askLuna('How is the city doing today?');
        });
        
        document.getElementById('askLuna').addEventListener('click', () => {
            app.askLuna('What BioCore effects do you recommend?');
        });
        
        document.getElementById('askLuna').addEventListener('click', () => {
            app.askLuna('Optimize the entire system');
        });
        
        document.getElementById('askLuna').addEventListener('click', () => {
            app.askLuna('Help me understand the BioCore system');
        });
    </script>

    <script>
        // Rust Real-time Dashboard Application
        class RustRealtimeApp {
            constructor() {
                this.websocket = null;
                this.isConnected = false;
                this.reconnectAttempts = 0;
                this.maxReconnectAttempts = 5;
                
                this.initializeElements();
                this.connectToRustSystem();
            }

            initializeElements() {
                this.rustTerminal = document.getElementById('rustTerminal');
                this.connectionStatus = document.getElementById('connectionStatus');
                this.realDataDisplay = document.getElementById('realDataDisplay');
            }

            connectToRustSystem() {
                try {
                    console.log('ü¶Ä Connecting to Rust Real-time System...');
                    this.websocket = new WebSocket('ws://localhost:8766');

                    this.websocket.onopen = () => {
                        console.log('‚úÖ Connected to Rust Real-time System');
                        this.isConnected = true;
                        this.reconnectAttempts = 0;
                        this.updateConnectionStatus(true);
                        this.addTerminalLine('‚úÖ RUST SYSTEM: Connection established', 'output');
                        this.addTerminalLine('ü¶Ä THREAD SAFETY: Confirmed', 'output');
                        this.addTerminalLine('ü¶Ä MEMORY SAFETY: Enabled', 'output');
                        this.addTerminalLine('ü¶Ä REAL-TIME PROCESSING: Active', 'output');
                    };

                    this.websocket.onmessage = (event) => {
                        this.handleRustMessage(JSON.parse(event.data));
                    };

                    this.websocket.onclose = () => {
                        console.log('üî¥ Disconnected from Rust System');
                        this.isConnected = false;
                        this.updateConnectionStatus(false);
                        this.addTerminalLine('‚ö†Ô∏è CONNECTION LOST: Attempting reconnect...', 'output');
                        this.attemptReconnect();
                    };

                    this.websocket.onerror = (error) => {
                        console.error('‚ùå Rust WebSocket error:', error);
                        this.addTerminalLine('‚ùå RUST ERROR: Connection failed', 'output');
                        this.showError('Failed to connect to Rust system. Make sure the Rust server is running.');
                    };

                } catch (error) {
                    console.error('‚ùå Connection failed:', error);
                    this.addTerminalLine('‚ùå RUST ERROR: Failed to initialize', 'output');
                    this.showError('Failed to connect to Rust real-time system. Please start RUST_REALTIME_ONLINE.py first.');
                }
            }

            handleRustMessage(data) {
                console.log('ü¶Ä Received Rust message:', data);

                switch (data.type) {
                    case 'rust_welcome':
                        this.displayRustCode(data.data.message);
                        break;
                    
                    case 'rust_real_data':
                        this.displayRealData(data.data);
                        break;
                    
                    case 'rust_realtime_started':
                        this.displayRustCode(data.data.message);
                        this.addTerminalLine('ü¶Ä REAL-TIME PROCESSING: Started', 'output');
                        break;
                }
            }

            displayRustCode(code) {
                const lines = code.split('\n');
                lines.forEach(line => {
                    if (line.trim()) {
                        // Syntax highlighting for Rust code
                        let highlightedLine = line
                            .replace(/\/\/.*/g, '<span class="rust-comment">$&</span>')
                            .replace(/\b(use|fn|let|mut|async|await|struct|impl|match|Some|None|Ok|Err)\b/g, '<span class="rust-keyword">$&</span>')
                            .replace(/\b(main|process_weather_data|analyze_air_quality|optimize_traffic)\b/g, '<span class="rust-function">$&</span>')
                            .replace(/"[^"]*"/g, '<span class="rust-string">$&</span>')
                            .replace(/\b\d+\.?\d*\b/g, '<span class="rust-number">$&</span>');
                        
                        this.addTerminalLine(highlightedLine, 'code');
                    }
                });
            }

            displayRealData(data) {
                const dataType = data.data_type.toUpperCase();
                const realData = data.real_data;
                const rustResponse = data.rust_response;

                // Display in terminal
                this.addTerminalLine(`ü¶Ä FETCHING ${dataType} DATA...`, 'command');
                this.displayRustCode(rustResponse);

                // Display in data panel
                this.realDataDisplay.innerHTML = `
                    <div class="data-item">
                        <div class="data-label">üì° ${dataType} Data Retrieved</div>
                        <div class="data-value">Processing with Rust memory safety...</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">üïê Timestamp</div>
                        <div class="data-value">${realData.timestamp || new Date().toISOString()}</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">ü¶Ä Processing Status</div>
                        <div class="data-value">Thread-safe & Memory-safe</div>
                    </div>
                `;
            }

            addTerminalLine(content, type = 'output') {
                const line = document.createElement('div');
                line.className = 'terminal-line';
                
                if (type === 'command') {
                    line.innerHTML = `<span class="terminal-prompt">$</span> <span class="terminal-command">${content}</span>`;
                } else if (type === 'code') {
                    line.innerHTML = `<span class="rust-code">${content}</span>`;
                } else {
                    line.innerHTML = `<span class="terminal-output">${content}</span>`;
                }
                
                this.rustTerminal.appendChild(line);
                this.scrollToBottom();
            }

            updateConnectionStatus(connected) {
                const statusElement = this.connectionStatus;
                if (connected) {
                    statusElement.className = 'connection-status connected';
                    statusElement.innerHTML = 'üü¢ RUST SYSTEM CONNECTED';
                } else {
                    statusElement.className = 'connection-status disconnected';
                    statusElement.innerHTML = 'üî¥ RUST SYSTEM OFFLINE';
                }
            }

            fetchRealData(dataType) {
                if (!this.isConnected) {
                    this.addTerminalLine('‚ùå ERROR: Not connected to Rust system', 'output');
                    return;
                }

                this.addTerminalLine(`ü¶Ä FETCHING ${dataType.toUpperCase()} DATA...`, 'command');
                
                const message = {
                    type: 'get_real_data',
                    data: {
                        data_type: dataType
                    }
                };
                
                this.websocket.send(JSON.stringify(message));
            }

            startRealtime() {
                if (!this.isConnected) {
                    this.addTerminalLine('‚ùå ERROR: Not connected to Rust system', 'output');
                    return;
                }

                this.addTerminalLine('ü¶Ä STARTING REAL-TIME PROCESSING...', 'command');
                
                const message = {
                    type: 'start_realtime'
                };
                
                this.websocket.send(JSON.stringify(message));
            }

            attemptReconnect() {
                if (this.reconnectAttempts < this.maxReconnectAttempts) {
                    this.reconnectAttempts++;
                    this.addTerminalLine(`üîÑ RECONNECT ATTEMPT ${this.reconnectAttempts}/${this.maxReconnectAttempts}`, 'output');
                    
                    setTimeout(() => {
                        this.connectToRustSystem();
                    }, 3000 * this.reconnectAttempts);
                } else {
                    this.addTerminalLine('‚ùå MAX RECONNECT ATTEMPTS REACHED', 'output');
                    this.showError('Failed to reconnect to Rust system. Please refresh the page and ensure the Rust server is running.');
                }
            }

            showError(message) {
                const errorLine = document.createElement('div');
                errorLine.className = 'terminal-line';
                errorLine.innerHTML = `<span class="terminal-output">‚ùå ${message}</span>`;
                this.rustTerminal.appendChild(errorLine);
                this.scrollToBottom();
            }

            scrollToBottom() {
                this.rustTerminal.scrollTop = this.rustTerminal.scrollHeight;
            }
        }

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ü¶Ä Initializing Rust Real-time Dashboard...');
            const app = new RustRealtimeApp();
        });
    </script>
</body>
</html>
